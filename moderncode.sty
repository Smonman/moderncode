%%% MODERN CODE
% Author: Simon Josef Kreuzpointner
% Date: 09.10.2024
% Version: 0.5.0

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{moderncode}[2024/10/09 modern code]

\RequirePackage[utf8]{inputenc} % input encoding
\RequirePackage[T1]{fontenc} % font encoding for umlaute
\RequirePackage{xcolor}
\RequirePackage[many]{tcolorbox}

\definecolor{codegray}{HTML}{adb5bd}
\definecolor{codegraylighter}{HTML}{f8f9fa}
\definecolor{codegraylight}{HTML}{e9ecef}
\definecolor{codegraydark}{HTML}{343a40}
\definecolor{codegraydarker}{HTML}{212529}
\definecolor{codegreen}{HTML}{198754}
\definecolor{codeblue}{HTML}{1733BF}

\tcbuselibrary{listingsutf8}
\tcbuselibrary{breakable}
\tcbuselibrary{skins}

\tcbset{%
    moderncode/.style={
            enhanced jigsaw,
            arc=3pt,
            boxrule=1pt,
            boxsep=0.5em,
            titlerule=0pt,
            left=2.5em,
            top=0.25em,
            right=0.3em,
            bottom=0.25em,
            colframe=codegraylight,
            colback=codegraylighter,
            halign title=center,
            fonttitle=\ttfamily,
            coltitle=codegraydarker,
        },
    moderncode/inline/.style={
            standard,
            arc=2pt,
            boxrule=0.5pt,
            boxsep=0.2em,
            titlerule=0em,
            left=0.1em,
            top=0em,
            right=0.05em,
            bottom=0em,
            colframe=codegraylight,
            colback=codegraylighter,
        },
    moderncode/key/.style={
            enhanced,
            arc=1pt,
            boxrule=0.5pt,
            boxsep=0.2em,
            titlerule=0pt,
            left=0em,
            top=0em,
            right=0.08em,
            bottom=0em,
            colframe=codegraydarker,
            colback=codegraydark,
            coltext=codegraylight,
            fuzzy shadow={0pt}{-1pt}{0.1pt}{0.5pt}{codegraydarker},
        }
}

\lstdefinestyle{tcboptions}{
    backgroundcolor=,
    framerule=0pt,
    framesep=0em,
    rulesep=0em,
    xleftmargin=0em,
    xrightmargin=0em,
    aboveskip=0ex,
    belowskip=0ex,
    frame=,
    stepnumber=1,
}

\NewTotalTCBox{\moderncodeinline}{ O{} O{} v }{%
    verbatim,
    moderncode/inline
}{%
    \lstinline[language={#1},#2]^#3^%
}

\NewTotalTCBox{\moderncodekey}{ v }{%
    verbatim,
    moderncode/key
}{%
    \lstinline[basicstyle=\sffamily\small]^#1^%
}

\NewTCBInputListing{\moderncodeinput}{ O{} O{} O{} m }{%
    listing only,
    moderncode,
    listing options={
            style=tcboptions,
            language={#1},
            #2%
        },
    listing file={#4},
    #3%
}

\DeclareTCBListing{moderncode}{ O{} O{} O{} }{%
    listing only,
    moderncode,
    listing options={
            style=tcboptions,
            language={#1},
            #2%
        },
    #3%
}

\DeclareTCBListing{moderncodeout}{ O{} O{} }{
    listing only,
    moderncode,
    listing options={
            style=tcboptions,
            numbers=none,
            #1%
        },
    #2%
}

%%% LSTLISTING STYLE
\lstdefinestyle{lststandardstyle}{
    frame=single,
    framerule=1pt,
    framesep=0.2em,
    framexleftmargin=2em,
    xleftmargin=2.3em,
    xrightmargin=0.4em,
    aboveskip=0ex,
    belowskip=0ex,
    rulesep=0em,
    rulecolor=\color{codegraylight},
    backgroundcolor=\color{codegraylighter},
    basicstyle=\ttfamily,
    breakatwhitespace=false,
    breaklines=true,
    captionpos=t,
    commentstyle=\color{codegray},
    deletekeywords={},
    extendedchars=true,
    firstnumber=1,
    keepspaces=true,
    keywordstyle=\color{codeblue}\bfseries,
    morekeywords={*,...},
    stringstyle=\color{codegreen},
    numbers=left,
    numbersep=1em,
    numberstyle=\ttfamily\small\color{codegray},
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    stepnumber=1,
    tabsize=4,
    mathescape=true,
    escapechar=!,
    escapeinside={<*}{*>},
    linewidth=\textwidth,
    postbreak=\mbox{\textcolor{codegray}{\(\hookrightarrow\)}\space},
}

\lstdefinestyle{lstoutput}{
    frame=single,
    framerule=0.1em,
    framesep=0.2em,
    framexleftmargin=0em,
    xleftmargin=0.3em,
    xrightmargin=0.4em,
    aboveskip=0ex,
    belowskip=0ex,
    rulesep=0em,
    rulecolor=\color{codegraylight},
    basicstyle=\ttfamily,
    backgroundcolor=\color{codegraylighter},
    breakatwhitespace=false,
    breaklines=true,
    captionpos=t,
    extendedchars=true,
    firstnumber=1,
    keepspaces=true,
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    stepnumber=0,
    tabsize=4,
    title=Output,
    escapechar=!,
    escapeinside={<*}{*>},
    linewidth=\textwidth,
}

\lstdefinelanguage{pseudo}{
    mathescape=true,
    basicstyle=,
    keywordstyle=\color{black}\bfseries\em,
    morekeywords={function, returns, return, if, then, else, and, or, not, loop, do, while, for, each, switch, case, foreach, begin, end, endif, until, repeat, null},
    sensitive=false,
    morecomment=[l]{//},
    morecomment=[s]{/*}{*/},
    morestring=[b]"
}

\lstset{
    style=lststandardstyle
}